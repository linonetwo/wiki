!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(T){"use strict";T.defineMode("tiddlywiki5",function(n,d){var c={rainbow:["keyword","variable-2","variable-3"]},o={changecount:!0,colour:!0,"colour-picker":!0,contrastcolour:!0,"copy-to-clipboard":!0,csvtiddlers:!0,datauri:!0,dumpvariables:!0,"image-picker":!0,jsontiddler:!0,jsontiddlers:!0,lingo:!0,"list-links":!0,"list-links-draggable":!0,"list-tagged-draggable":!0,"list-thumbnails":!0,makedatauri:!0,now:!0,qualify:!0,resolvepath:!0,"box-shadow":!0,filter:!0,transition:!0,"background-linear-gradient":!0,"transform-origin":!0,toc:!0,"toc-expandable":!0,"toc-selective-expandable":!0,"toc-tabbed-internal-nav":!0,"toc-tabbed-external-nav":!0,tabs:!0,tag:!0,"tag-picker":!0,"tag-pill":!0,thumbnail:!0,timeline:!0,tree:!0,unusedtitle:!0,version:!0};function u(e){!T.findModeByName||(t=T.findModeByName(e))&&(e=t.mime||t.mimes[0]);var t=T.getMode(n,e);return"null"==t.name?null:t}d.fencedCodeBlockHighlighting===undefined&&(d.fencedCodeBlockHighlighting=!0),d.fencedCodeBlockDefaultMode===undefined&&(d.fencedCodeBlockDefaultMode="text/plain");var f=/^\-\-\-+$/,k=/^<<</,s=/^```[ \t]*([\w\/+#-]*)[^\n`]*$/,r=/^```$/;function m(e,t,n){return(t.tokenize=n)(e,t)}function i(e){e.line++,e.listLevel=0,e.boldLine=!1}function b(e,t){var n=e.sol(),o=function(e,t,n){var o=t.peek();if(e&&/[<\/\*{}\-`]/.test(o)){if(t.match(k))return function(e,t){var n=1;for(;e.match(k);)n++;t.quoteLevel==n?t.quoteLevel--:t.quoteLevel<n?(t.quoteHead=!0,t.quoteLevel=n,t.tokenize=function(e,t){return t.quoteHead=!1,t.tokenize=b,e.sol()?null:(e.skipToEnd(),"tag")}):t.quoteLevel=n-1;return"quote line-cm-quote-line"}(t,n);if(t.match(f))return"hr";var r=null;if(r=t.match(s,!1))return function(e,o,r){return o.tokenize=function(e,t){t.tokenize=b;var n=d.fencedCodeBlockHighlighting&&u(r[1]||d.fencedCodeBlockDefaultMode);return t.codeBlockModeState=n?{mode:n,state:T.startState(n),start:o.line}:"unknown",r[1]?(e.skipToEnd(),"tag"):null},e.match("```"),"comment"}(t,n,r)}r=null;if(e&&(r=t.match(/^\s*([\/\*!#;:>|])/))){if("!"===(o=r[1])){for(var i=1;t.eat("!");)i++;return t.skipToEnd(),"header h"+i}if(/[\*#;:]/.test(o)){for(var a=1,l=o;o=t.eat(/[\*#;:]/);)a++,l=o;return n.boldLine=";"===l,n.listLevel=a,"list "+c.rainbow[a%c.rainbow.length]+(";"===l?" strong":"")}if(">"===o)return t.eatWhile(">"),"quote";if("|"===o)return"header"}if(t.next(),/[hf]/i.test(o)&&/[ti]/i.test(t.peek())&&t.match(/\b(ttps?|tp|ile):\/\/[\-A-Z0-9+&@#\/%?=~_|$!:,.;]*[A-Z0-9+&@#\/%=~_|$]/i,!0))return"externallink link";if("$"==o&&t.match("$",!1)&&!t.match("$$",!1))return t.next(),function(e){e.tokenize=b;var t=d.fencedCodeBlockHighlighting&&u("text/x-latex");return e.LaTeXModeState=t?{mode:t,state:T.startState(t),start:e.line}:"unknown","comment"}(n);if("`"==o)return m(t,n,p);if("/"==o&&t.eat("/"))return m(t,n,v);if("{"==o&&t.eat("{"))return m(t,n,S);if("["==o&&t.eat("["))return m(t,n,g);if("_"==o&&t.eat("_"))return m(t,n,h);if("^"==o&&t.eat("^"))return m(t,n,B);if(","==o&&t.eat(","))return m(t,n,L);if("~"==o&&t.eat("~"))return m(t,n,x);return"'"==o&&t.eat("'")?m(t,n,M):"<"==o&&t.eat("<")?m(t,n,y):null}(n,e,t);return null==o&&(o=""),0<t.quoteLevel&&n&&(o+=" line-cm-quote-line quote-"+t.quoteLevel),null!=t.codeBlockModeState&&(o+=" comment"),0<t.listLevel&&(o+=" list "+c.rainbow[t.listLevel%c.rainbow.length]),t.boldLine&&(o+=" strong"),o.trim()}function M(e,t){for(var n,o=!1;n=e.next();){if("'"==n&&o){t.tokenize=b;break}o="'"==n}return"strong"}function p(e,t){for(var n;n=e.next();)if("`"==n){t.tokenize=b;break}return"comment"}function v(e,t){for(var n,o=!1;n=e.next();){if("/"==n&&o){t.tokenize=b;break}o="/"==n}return"em"}function S(e,t){for(var n,o=!1;n=e.next();){if("}"==n&&o){t.tokenize=b;break}o="}"==n}return"builtin"}function g(e,t){if("[["==e.current())return t.pastDivider=!1,"link";if("]"==e.peek()&&(e.next(),"]"==e.next()))return t.tokenize=b,"link";for(var n,o=t.pastDivider;n=e.peek();){if(!o&&"|"==n)return e.next(),t.pastDivider=!0,"internallink link";if("]"==n&&"]"==e.peek())return"internallink link";if(n=e.next(),/[hf]/i.test(n)&&/[ti]/i.test(e.peek())&&e.match(/\b(ttps?|tp|ile):\/\/[\-A-Z0-9+&@#\/%?=~_|$!:,.;]*[A-Z0-9+&@#\/%=~_|$]/i,!0))return"externallink link";e.eatWhile(/[^|\]]/)}return null}function h(e,t){for(var n,o=!1;n=e.next();){if("_"==n&&o){t.tokenize=b;break}o="_"==n}return"underlined"}function L(e,t){for(var n,o=!1;n=e.next();){if(","==n&&o){t.tokenize=b;break}o=","==n}return"string subscript"}function B(e,t){for(var n,o=!1;n=e.next();){if("^"==n&&o){t.tokenize=b;break}o="^"==n}return"string superscript"}function x(e,t){for(var n,o=!1;n=e.next();){if("~"==n&&o){t.tokenize=b;break}o="~"==n}return"strikethrough"}function y(e,t){if("<<"==e.current())return"macro";var n=e.next();return n?">"==n&&">"==e.peek()?(e.next(),t.tokenize=b,"macro"):(e.eatWhile(/[\w\$_]/),o.propertyIsEnumerable(e.current())?"keyword":"macro"):(t.tokenize=b,null)}var t={blankLine:function(e){return i(e),""},closeBrackets:"()[]{}''\"\"``",startState:function(){return{tokenize:b,curStream:null,line:0,quoteLevel:0,quoteHead:!1,listLevel:0,boldLine:!1,codeBlockModeState:null,LaTeXModeState:null}},copyState:function(e){var t,n={};for(t in e)n[t]=e[t];e.codeBlockModeState&&"object"==typeof e.codeBlockModeState&&(n.codeBlockModeState={mode:e.codeBlockModeState.mode,state:T.copyState(e.codeBlockModeState.mode,e.codeBlockModeState.state),start:e.start}),e.LaTeXModeState&&(n.LaTeXModeState={mode:e.LaTeXModeState.mode,state:T.copyState(e.LaTeXModeState.mode,e.LaTeXModeState.state),start:e.start})},token:function(e,t){return e!=t.curStream&&(i(t),t.curStream=e),null!=t.codeBlockModeState?e.match(r)?(t.codeBlockModeState=null,"comment"):"string"==typeof t.codeBlockModeState?(e.skipToEnd(),"comment line-background-cm-code-block-line"):t.codeBlockModeState.mode.token(e,t.codeBlockModeState.state)+" line-background-cm-code-block-line":null!=t.LaTeXModeState?e.match("$$")?(t.LaTeXModeState=null,"comment"):"string"==typeof t.LaTeXModeState?(e.skipToEnd(),"comment latex"):t.LaTeXModeState.mode.token(e,t.LaTeXModeState.state)+" latex":e.match(/^\s+$/,!0)||e.match(/\s+$/,!0)?null:t.tokenize(e,t)},innerMode:function(e){return null!=e.codeBlockModeState&&"object"==typeof e.codeBlockModeState?e.codeBlockModeState:null!=e.LaTeXModeState&&"object"==typeof e.LaTeXModeState?e.LaTeXModeState:{state:e,mode:t}},indent:function(e,t,n){return null!=e.codeBlockModeState&&"object"==typeof e.codeBlockModeState&&"function"==typeof e.codeBlockModeState.mode.indent?e.codeBlockModeState.mode.indent(e.codeBlockModeState.state,t,n):T.Pass}};return t}),T.defineMIME("text/vnd.tiddlywiki","tiddlywiki5"),T.defineMIME("","tiddlywiki5")});